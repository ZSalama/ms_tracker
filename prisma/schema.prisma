// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider  = "postgresql"
    url       = env("DATABASE_URL")
    directUrl = env("POSTGRES_URL_NON_POOLING") // uses a direct connection
}

model User {
    id        Int      @id @default(autoincrement())
    clerkId   String   @unique
    email     String   @unique
    name      String?
    legion    Int      @default(0)
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    characters Character[] // One-to-many to Character

    @@map("user")
}

model Character {
    id          Int      @id @default(autoincrement())
    name        String   @unique
    level       Int      @default(1)
    class       String   @default("beginner")
    createdAt   DateTime @default(now())
    updatedAt   DateTime @updatedAt
    combatPower Int      @default(0)
    arcaneForce Int      @default(0)
    sacredPower Int      @default(0)

    userId Int
    user   User @relation(fields: [userId], references: [id], onDelete: Cascade)

    gears GearItem[] // One-to-many to Gear

    @@map("character")
}

model GearItem {
    id          Int    @id @default(autoincrement())
    name        String @default("Unnamed")
    type        String @default("Ring")
    rarity      String @default("None")
    tradeStatus String @default("untradeable") @map("trade_status")
    starForce   Int    @default(0) @map("star_force")

    url String? // URL to the image of the gear item

    attackPowerIncrease Int @default(0) @map("attack_power_increase")
    combatPowerIncrease Int @default(0) @map("combat_power_increase")
    requiredLevel       Int @default(0) @map("required_level")

    characterId Int
    character   Character @relation(fields: [characterId], references: [id], onDelete: Cascade)

    createdAt  DateTime @default(now())
    updatedAt  DateTime @updatedAt
    isEquipped Boolean  @default(false)

    str                   Int?
    flameStr              Int?
    starStr               Int?
    dex                   Int?
    flameDex              Int?
    starDex               Int?
    int                   Int?
    flameInt              Int?
    starInt               Int?
    luk                   Int?
    flameLuk              Int?
    starLuk               Int?
    maxHP                 Int?
    flameMaxHP            Int?
    starMaxHP             Int?
    maxMP                 Int?
    flameMaxMP            Int?
    starMaxMP             Int?
    attackPower           Int?
    flameAttackPower      Int?
    starAttackPower       Int?
    magicAttackPower      Int?
    flameMagicAttackPower Int?
    starMagicAttackPower  Int?
    defense               Int?
    flameDefense          Int?
    starDefense           Int?
    jump                  Int?
    flameJump             Int?
    starJump              Int?
    speed                 Int?
    flameSpeed            Int?
    starSpeed             Int?

    allStat      Int?
    flameAllStat Int?
    starAllStat  Int?

    bossDamage      Int?
    flameBossDamage Int?
    starBossDamage  Int?

    ignoreEnemyDefense      Int?
    flameIgnoreEnemyDefense Int?

    potential Json? @default("{}")
}
